Copy code
Html
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Shadow Haveli Escape</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
*{box-sizing:border-box}
body{margin:0;background:#000;color:#fff;font-family:Arial;text-align:center}
#hud{display:flex;justify-content:space-between;align-items:center;padding:8px 10px;font-size:13px}
#minimap{
  width:90px;height:90px;border:1px solid #555;border-radius:8px;
  position:relative;background:#111
}
.dot{position:absolute;width:6px;height:6px;border-radius:50%}
.playerDot{background:#5cff7a}
.enemyDot{background:#ff4444}
#game{position:relative;width:100%;height:75vh;overflow:hidden;background:#000}
.room{position:absolute;inset:0;background:radial-gradient(circle at center,#222,#000)}
.floor{position:absolute;bottom:0;left:0;width:100%;height:90px;background:#050505}
#player{position:absolute;bottom:90px;left:45%;width:40px;height:55px;background:#5cff7a;border-radius:8px}
#enemy{position:absolute;top:20px;left:20%;width:45px;height:60px;background:#ff4444;border-radius:8px;animation:flicker 1.5s infinite}
@keyframes flicker{0%,100%{opacity:.9}50%{opacity:.6}}
#key{position:absolute;bottom:90px;left:20px;width:26px;height:18px;background:gold;border-radius:4px;box-shadow:0 0 10px gold}
#door{position:absolute;right:10px;bottom:90px;width:55px;height:85px;background:#333;border-radius:6px}
#controls button{padding:12px 18px;margin:6px;border:none;border-radius:25px;font-size:16px;background:#00cec9}
#overlay{position:absolute;inset:0;display:none;align-items:center;justify-content:center;background:#fff;color:#000;font-size:26px;font-weight:bold}
#torch{position:absolute;inset:-50%;pointer-events:none;
  background:radial-gradient(circle at center,rgba(255,255,200,.7) 0%,rgba(0,0,0,.9) 60%);
  mix-blend-mode:overlay}
</style>
</head>

<body>

<div id="hud">
  <div>Room: <b id="roomTxt">1</b> | Key: <b id="keyTxt">‚ùå</b></div>
  <div id="minimap">
    <div id="pDot" class="dot playerDot"></div>
    <div id="eDot" class="dot enemyDot"></div>
  </div>
</div>

<div id="game">
  <div class="room"></div>
  <div id="player"></div>
  <div id="enemy"></div>
  <div id="key"></div>
  <div id="door"></div>
  <div class="floor"></div>
  <div id="torch"></div>
  <div id="overlay">üëª</div>
</div>

<div id="controls">
  <button onclick="move(-18)">‚¨Ö</button>
  <button onclick="toggleTorch()">üî¶</button>
  <button onclick="move(18)">‚û°</button>
  <button onclick="toggleMusic()">üéµ</button>
</div>

<script>
/* ===== AUDIO (SAFE BACKGROUND MUSIC) ===== */
const AudioCtx = window.AudioContext||window.webkitAudioContext;
const ctx = new AudioCtx();
let musicOn=false, musicOsc, musicGain;

function startMusic(){
  musicOsc = ctx.createOscillator();
  musicGain = ctx.createGain();
  musicOsc.type="sine";
  musicOsc.frequency.value=90; // dark ambient
  musicGain.gain.value=0.04;
  musicOsc.connect(musicGain);
  musicGain.connect(ctx.destination);
  musicOsc.start();
}
function stopMusic(){
  if(musicOsc){ musicOsc.stop(); musicOsc=null; }
}
function toggleMusic(){
  musicOn=!musicOn;
  if(musicOn) startMusic(); else stopMusic();
}

/* ===== GAME ===== */
const p=document.getElementById("player");
const e=document.getElementById("enemy");
const k=document.getElementById("key");
const d=document.getElementById("door");
const ov=document.getElementById("overlay");
const torch=document.getElementById("torch");
const roomTxt=document.getElementById("roomTxt");
const keyTxt=document.getElementById("keyTxt");
const pDot=document.getElementById("pDot");
const eDot=document.getElementById("eDot");

let px=window.innerWidth*0.45, speed=6, hasKey=false, room=1, torchOn=true;

function move(s){
  px+=s;
  if(px<0)px=0;
  if(px>window.innerWidth-50)px=window.innerWidth-50;
  p.style.left=px+"px";
  checkKey(); checkDoor(); updateMiniMap();
}
function toggleTorch(){ torchOn=!torchOn; torch.style.display=torchOn?"block":"none"; }

function checkKey(){
  if(hasKey) return;
  if(p.getBoundingClientRect().right > k.getBoundingClientRect().left){
    hasKey=true; k.style.display="none"; keyTxt.textContent="‚úî";
  }
}
function checkDoor(){
  if(!hasKey) return;
  if(p.getBoundingClientRect().right > d.getBoundingClientRect().left){
    nextRoom();
  }
}
function nextRoom(){
  room++; roomTxt.textContent=room; hasKey=false; keyTxt.textContent="‚ùå";
  k.style.display="block"; px=window.innerWidth*0.45; p.style.left=px+"px";
  e.style.top="20px"; e.style.left=(10+Math.random()*60)+"%"; speed+=3;
}

function updateMiniMap(){
  const mw=90, mh=90;
  const pw = (px/(window.innerWidth-50))*mw;
  pDot.style.left=pw+"px"; pDot.style.top=(mh-10)+"px";
  const ew = (e.offsetLeft/(window.innerWidth-50))*mw;
  const eh = (e.offsetTop/(window.innerHeight-180))*mh;
  eDot.style.left=ew+"px"; eDot.style.top=eh+"px";
}

setInterval(()=>{
  e.style.top=(e.offsetTop+speed)+"px";
  const er=e.getBoundingClientRect(), pr=p.getBoundingClientRect();
  if(!(er.right<pr.left||er.left>pr.right||er.bottom<pr.top||er.top>pr.bottom)){
    ov.style.display="flex";
    setTimeout(()=>location.reload(),400);
  }
  if(e.offsetTop>window.innerHeight-180){
    e.style.top="20px"; e.style.left=(10+Math.random()*60)+"%";
  }
  updateMiniMap();
},220);
</script>
</body>
</html>
